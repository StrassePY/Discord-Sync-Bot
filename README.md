# Discord Sync Bot

[![Build Status](https://img.shields.io/badge/build-passing-brightgreen)](https://github.com/StrassePY/Discord-Sync-Bot/actions)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Stars](https://img.shields.io/github/stars/StrassePY/Discord-Sync-Bot?style=social)](https://github.com/StrassePY/Discord-Sync-Bot)


An opinionated Discord bot template that keeps application commands in sync across multiple guilds. It bundles a configurable guild registry, per-guild command scoping, and moderation utilities that let administrators enable or disable slash commands without touching the codebase.

- **Per-guild command control** – scope any slash command globally, to selected guilds, or exclude specific servers via JSON config or moderation commands.
- **Automatic synchronization** – resolves configured guild IDs and mirrors the configured commands on startup, keeping unmanaged guilds clean.
- **Discord-native UI** – moderation commands show rich success messages and an overview container with synced guilds, active commands, and disabled command groups.
- **Structured logging** – colorized console output highlights bot state, sync progress, warnings, and errors.

## Quick Start

1. **Prerequisites**
	- Python 3.11+
	- A Discord application with a bot token
	- `discord.py` 2.3+ and `colorama`

2. **Clone & set up a virtual environment**

	```cmd
	git clone https://github.com/StrassePY/Discord-Sync-Bot.git
	cd Discord-Sync-Bot
	python -m venv .venv
	.venv\Scripts\activate
	pip install -U discord.py colorama
	```

3. **Configure the bot token** in `config/data/config.json`:

	```json
	{
		 "TOKEN": "YOUR-BOT-TOKEN",
		 "GUILD_ID": 123456789012345678
	}
	```

	The first run will create this file automatically if it is missing. `GUILD_ID` is available for custom logic; the sync system does not require it.

4. **Register guilds to manage** in `cogs/guildSync/core/config/data/guilds.json`:

	```json
	{
		 "Main Server": 123456789012345678,
		 "Testing Grounds": 987654321098765432
	}
	```

5. **(Optional) Seed command scopes** in `cogs/guildSync/core/config/data/commands.json`. For example, disable a command everywhere or exclude a guild:

	```json
	{
		 "commands": {
			  "moderation.disable-command": [],
			  "moderation.synced": ["*"]
		 }
	}
	```

6. **Run the bot**:

	```cmd
	python app.py
	```

	The bot loads configured cogs, logs guild sync progress, then runs continuously.

## Available Slash Commands

All commands are exposed under grouped namespaces defined in `interface/commands.py`.

- `moderation synced` – Shows a dashboard-style view of synced guilds, registered commands, and disabled groups.
- `moderation disable-command <command> <guild|global>` – Disable a command for a specific guild or every guild and immediately re-sync.
- `moderation enable-command <command> <guild|global>` – Re-enable a command where it was disabled and re-sync the target guilds.
- `debug ping` – Quick latency check that responds ephemerally.

The guild and command autocompletes surface configured guilds and available command keys, making moderation changes safe and discoverable.

## How Command Scoping Works

- Command keys follow the pattern generated by `CommandCloner`, i.e. `group.subcommand` (spaces become dots, lower-case).
- A scope of `[]` disables the command everywhere, while `{"exclude": ["guild_id"]}` keeps it global except for listed guilds.
- Use `*` in a scope array to mark a command as global.
- Moderation commands update `commands.json` for you; manual edits are useful for bulk changes or version control.

## Architecture Overview

- `app.py` – Boots the bot, loads cogs from the `coglist`, and wires up logging.
- `config/lib.py` – Ensures the core configuration file exists and surfaces environment values.
- `cogs/guildSync` – Implements guild discovery, command cloning, sync state, and the moderation slash commands.
- `cogs/debug` – Example debugging cog with a `ping` command.
- `interface/logger.py` – Colorized console logger used across the project.

Sync flow highlights:

1. `GuildSyncEngine` loads guild IDs from `guilds.json`, resolves them to `discord.Guild` objects, and keeps a cached snapshot.
2. `SyncCommandsEngine` clones registered command groups, respects per-guild scopes, and syncs them to Discord.
3. Unmanaged guilds (present in Discord but not in the config) have commands removed to avoid drift.

## Extending the Bot

- Add new cogs in `cogs/`, then register their dotted path in `aclient.coglist` inside `app.py`.
- Define new root slash command groups in `interface/commands.py` so they are picked up by the sync engine.
- Use the provided logger for consistent output and timestamps.

## Troubleshooting

- Double-check that the bot has the **application.commands** and **bot** OAuth scopes and is a member of each configured guild.
- If commands fail to sync, inspect the console output: the sync engine logs missing permissions, HTTP errors, and command cloning issues.
- Delete `commands.json` or remove a command entry to reset its scope back to global defaults.

Happy syncing! Let the bot handle the repetitive command management so you can focus on features.
